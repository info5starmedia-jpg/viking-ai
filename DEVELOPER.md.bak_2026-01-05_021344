# Viking AI — Developer Spec (Canonical)

This document is the **single source of truth** for Viking AI’s event → scoring → output → alerts pipeline.

## Where the current rules live (existing code)
- Demand Tier definitions: `VIKING_AI_README_FANCY.md`
- Sellout Probability: `agents/sellout_probability_engine.py`
- Artist Rating: `agents/artist_rating_engine.py`
- Artist Resolver: `agents/artist_resolver.py`
- Demand Heatmap: `agents/demand_heatmap.py`
- Slash command UX: `bot.py`

## 1) Canonical Event Flow (Final)
1. **Fetch**
   - Ticketmaster events for an artist
   - Optional: RSS/news scan items
2. **Normalize**
   - Normalize event fields (artist, venue, city, date)
3. **Enrich**
   - Apply demand heuristics / rating engines
4. **Score**
   - Demand Tier
   - City-level score (if used)
   - Confidence score
5. **Output**
   - Produce locked “Intel Output Contract” payload for Discord output
6. **Alerts**
   - Trigger rules evaluate deltas and thresholds
7. **Evaluation**
   - Deterministic test suite for scoring and output contract

## 2) Intel Output Contract (FINAL & LOCKED)
TODO: Promote the existing bot output format into a strict schema:
- artist
- generated_at
- events[]
- notes[]
- event: id, name, date_local, city, venue, url, demand_tier, confidence, drivers[], warnings[]

## 3) Demand Tier Definitions (FINAL)
TODO: Copy exact tier definitions from `VIKING_AI_README_FANCY.md` and lock them here.

## 4) Confidence Scoring Framework (FINAL)
TODO: Lock confidence score rules and mapping 0–100.

## 5) Alert Messaging + Trigger Rules (FINAL)
TODO: Lock anti-spam + grouping + thresholds.

## 6) Evaluation Test Suite (FINAL)
TODO: Add tests for:
- contract validation
- deterministic scoring
- regression checks for message chunking
